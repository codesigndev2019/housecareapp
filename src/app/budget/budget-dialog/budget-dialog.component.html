<div class="dialog-container">
  <div class="dialog-header">
    <h2>{{ getTitleKey() | translate }}</h2>
    <button mat-icon-button (click)="onCancel()" class="close-btn" [attr.aria-label]="'actions.close' | translate">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <form [formGroup]="form" class="dialog-content">
    <!-- Movement Name -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>{{ 'budget.movementName' | translate }}</mat-label>
      <input matInput formControlName="name" [readonly]="isViewMode">
      <mat-icon matPrefix>label</mat-icon>
      @if (form.get('name')?.hasError('required') && form.get('name')?.touched) {
        <mat-error>{{ 'budget.errors.nameRequired' | translate }}</mat-error>
      }
    </mat-form-field>

    <!-- Description -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>{{ 'budget.description' | translate }}</mat-label>
      <textarea matInput formControlName="description" [readonly]="isViewMode" rows="3"></textarea>
      <mat-icon matPrefix>description</mat-icon>
    </mat-form-field>

    <!-- Currency and Amount Row -->
    <div class="form-row">
      <mat-form-field appearance="outline" class="currency-field">
        <mat-label>{{ 'budget.currency' | translate }}</mat-label>
        <mat-select formControlName="currency">
          @for (curr of currencies; track curr.value) {
            <mat-option [value]="curr.value">
              {{ curr.symbol }} {{ curr.value }}
            </mat-option>
          }
        </mat-select>
        <mat-icon matPrefix>payments</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="amount-field">
        <mat-label>{{ 'budget.amount' | translate }}</mat-label>
        <input matInput type="number" formControlName="amount" [readonly]="isViewMode" min="0" step="0.01">
        <mat-icon matPrefix>attach_money</mat-icon>
        @if (form.get('amount')?.hasError('required') && form.get('amount')?.touched) {
          <mat-error>{{ 'budget.errors.amountRequired' | translate }}</mat-error>
        }
        @if (form.get('amount')?.hasError('min') && form.get('amount')?.touched) {
          <mat-error>{{ 'budget.errors.amountMin' | translate }}</mat-error>
        }
      </mat-form-field>
    </div>

    <!-- Movement Type -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>{{ 'budget.movementType' | translate }}</mat-label>
      <mat-select formControlName="movementType">
        @for (type of movementTypes; track type.value) {
          <mat-option [value]="type.value">
            <div class="type-option">
              <mat-icon [class.income-icon]="type.value === 'income'" [class.expense-icon]="type.value === 'expense'">
                {{ type.icon }}
              </mat-icon>
              <span>{{ type.labelKey | translate }}</span>
            </div>
          </mat-option>
        }
      </mat-select>
      <mat-icon matPrefix>swap_vert</mat-icon>
    </mat-form-field>

    <!-- Category (from catalogs) -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>{{ 'budget.category' | translate }}</mat-label>
      <mat-select formControlName="categoryId">
        <mat-option value="">{{ 'budget.selectCategory' | translate }}</mat-option>
        @for (catalog of catalogs$ | async; track catalog.id) {
          @if (catalog.active) {
            <mat-option [value]="catalog.id">
              {{ catalog.name }}
            </mat-option>
          }
        }
      </mat-select>
      <mat-icon matPrefix>category</mat-icon>
    </mat-form-field>

    <!-- Fixed Movement Toggle -->
    <div class="toggle-row">
      <mat-slide-toggle 
        formControlName="isFixed" 
        color="primary"
        [disabled]="isViewMode">
        {{ 'budget.isFixed' | translate }}
      </mat-slide-toggle>
      <span class="toggle-hint">{{ 'budget.isFixedHint' | translate }}</span>
    </div>
  </form>

  @if (!isViewMode) {
    <div class="dialog-actions">
      <button mat-button (click)="onCancel()">{{ 'actions.cancel' | translate }}</button>
      <button mat-raised-button color="primary" (click)="onSave()" [disabled]="form.invalid">
        {{ (isEditMode ? 'actions.update' : 'actions.create') | translate }}
      </button>
    </div>
  }

  @if (isViewMode) {
    <div class="dialog-actions">
      <button mat-raised-button color="primary" (click)="onCancel()">{{ 'actions.close' | translate }}</button>
    </div>
  }
</div>
